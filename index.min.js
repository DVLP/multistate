let capabilities=["BLEND","CULL_FACE","DEPTH_TEST","DITHER","POLYGON_OFFSET_FILL","SAMPLE_ALPHA_TO_COVERAGE","SAMPLE_COVERAGE","SCISSOR_TEST","STENCIL_TEST","RASTERIZER_DISCARD"],featureNameByInt={},DEV_MODE=!1,arr3Eq=(a,p0,p1,p2)=>a[0]===p0&&a[1]===p1&&a[2]===p2,arr4Eq=(a,p0,p1,p2,p3)=>a[0]===p0&&a[1]===p1&&a[2]===p2&&a[3]===p3,set3=(a,p0,p1,p2)=>{a[0]=p0,a[1]=p1,a[2]=p2},set4=(a,p0,p1,p2,p3)=>{a[0]=p0,a[1]=p1,a[2]=p2,a[3]=p3};function enhanceWebGLContext(gl){var state,sgl;gl.stateSyncEnabled||(gl.stateSyncEnabled=!0,{state,sgl}=(featureNameByInt=capabilities.reduce((acc,key)=>(Number.isInteger(gl[key])&&(acc[gl[key]]=key),acc),{}),slowFetchGLState(gl)),gl.state=state,gl.sgl=sgl,gl.defaultDrawBuffers=Array(gl.getParameter(gl.MAX_DRAW_BUFFERS)).fill(gl.NONE),gl.defaultDrawBuffers[0]=gl.COLOR_ATTACHMENT0,wrapStatefulGLFunctions(gl),gl.defaultState=gl.createState(),gl.savedState=gl.createState())}function saveGLFeatures(gl){var capabilities=[gl.BLEND,gl.CULL_FACE,gl.DEPTH_TEST,gl.DITHER,gl.POLYGON_OFFSET_FILL,gl.SAMPLE_ALPHA_TO_COVERAGE,gl.SAMPLE_COVERAGE,gl.SCISSOR_TEST,gl.STENCIL_TEST],featuresState={};return capabilities.forEach(function(capability){featuresState[capability]=gl.isEnabled(capability)}),featuresState}function restoreGLFeatures(gl,feats,current){Object.keys(feats).forEach(feat=>{feats[feat]!==current[feat]&&(featureNameByInt[feat],feats[feat]?gl.enable(feat):gl.disable(feat))})}function setGLFeaturesPartial(gl,feats,snapshot){Object.keys(feats).forEach(feat=>{var value=feats[feat];void 0!==value&&(value?gl.enable(feat):gl.disable(feat))})}function saveStorei(gl){var pixelStoreiEnums=[gl.PACK_ALIGNMENT,gl.UNPACK_ALIGNMENT,gl.UNPACK_FLIP_Y_WEBGL,gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,gl.UNPACK_ROW_LENGTH,gl.UNPACK_SKIP_ROWS,gl.UNPACK_SKIP_PIXELS,gl.PACK_ROW_LENGTH,gl.PACK_SKIP_PIXELS,gl.PACK_SKIP_ROWS],storei={};return pixelStoreiEnums.forEach(function(feature){storei[feature]=gl.getParameter(feature)}),storei}function restoreStorei(gl,storei,current){Object.keys(storei).forEach(feat=>{storei[feat]!==current[feat]&&gl.pixelStorei(feat,storei[feat])})}function wrapStatefulGLFunctions(gl){let id=0,originalUseProgram=gl.useProgram,history=[],recording=!1,originalBindTexture=(gl.useProgram=function(program){if(gl.sgl.activeProgram!==program)return gl.sgl.activeProgram=program,originalUseProgram.call(gl,program)},gl.bindTexture),originalActiveTexture=(gl.bindTexture=function(type,texture){var currentActive=gl.state.activeTexture-gl.TEXTURE0;return gl.sgl.textures[currentActive]=texture?[type,texture]:null,originalBindTexture.call(gl,type,texture)},gl.state.activeTexture=gl.TEXTURE0,gl.activeTexture),originalViewport=(gl.activeTexture=function(slot){if(gl.state.activeTexture!==slot)return gl.state.activeTexture=slot,originalActiveTexture.call(gl,slot)},gl.viewport),originalBlendColor=(gl.viewport=function(x,y,width,height){arr4Eq(gl.state.viewport,x,y,width,height)||(set4(gl.state.viewport,x,y,width,height),originalViewport.call(gl,x,y,width,height))},gl.blendColor),originalBlendEquation=(gl.blendColor=function(red,green,blue,alpha){arr4Eq(gl.state.blendColor,red,green,blue,alpha)||(set4(gl.state.blendColor,red,green,blue,alpha),originalBlendColor.call(gl,red,green,blue,alpha))},gl.blendEquation),originalBlendEquationSeparate=(gl.blendEquation=function(mode){gl.state.blendEquationRgb===mode&&gl.state.blendEquationAlpha===mode||(gl.state.blendEquationRgb=mode,gl.state.blendEquationAlpha=mode,originalBlendEquation.call(gl,mode))},gl.blendEquationSeparate),originalBlendFunc=(gl.blendEquationSeparate=function(modeRGB,modeAlpha){gl.state.blendEquationRgb===modeRGB&&gl.state.blendEquationAlpha===modeAlpha||(gl.state.blendEquationRgb=modeRGB,gl.state.blendEquationAlpha=modeAlpha,originalBlendEquationSeparate.call(gl,modeRGB,modeAlpha))},gl.blendFunc),originalBlendFuncSeparate=(gl.blendFunc=function(sBoth,dBoth){arr4Eq(gl.state.blendFuncSeparate,sBoth,dBoth,sBoth,dBoth)||(set4(gl.state.blendFuncSeparate,sBoth,dBoth,sBoth,dBoth),originalBlendFunc.call(gl,sBoth,dBoth))},gl.blendFuncSeparate),originalCullFace=(gl.blendFuncSeparate=function(srcRGB,dstRGB,srcAlpha,dstAlpha){if(!arr4Eq(gl.state.blendFuncSeparate,srcRGB,dstRGB,srcAlpha,dstAlpha))return set4(gl.state.blendFuncSeparate,srcRGB,dstRGB,srcAlpha,dstAlpha),originalBlendFuncSeparate.call(gl,srcRGB,dstRGB,srcAlpha,dstAlpha)},gl.cullFace),originalFrontFace=(gl.cullFace=function(mode){if(gl.state.cullFaceMode!==mode)return gl.state.cullFaceMode=mode,originalCullFace.call(gl,mode)},gl.frontFace),originalLineWidth=(gl.frontFace=function(face){if(gl.state.frontFace!==face)return gl.state.frontFace=face,originalFrontFace.call(gl,face)},gl.lineWidth),originalClearColor=(gl.lineWidth=function(width){if(gl.state.lineWidth!==width)return gl.state.lineWidth=width,originalLineWidth.call(gl,width)},gl.clearColor),originalColorMask=(gl.clearColor=function(red,green,blue,alpha){if(!arr4Eq(gl.state.clearColor,red,green,blue,alpha))return set4(gl.state.clearColor,red,green,blue,alpha),originalClearColor.call(gl,red,green,blue,alpha)},gl.colorMask),originalClearDepth=(gl.colorMask=function(red,green,blue,alpha){if(!arr4Eq(gl.state.colorMask,red,green,blue,alpha))return set4(gl.state.colorMask,red,green,blue,alpha),originalColorMask.call(gl,red,green,blue,alpha)},gl.clearDepth),originalDepthFunc=(gl.clearDepth=function(depthValue){if(gl.state.clearDepth!==depthValue)return gl.state.clearDepth=depthValue,originalClearDepth.call(gl,depthValue)},gl.depthFunc),originalDepthMask=(gl.depthFunc=function(func){if(gl.state.depthFunc!==func)return gl.state.depthFunc=func,originalDepthFunc.call(gl,func)},gl.depthMask),originalDepthRange=(gl.depthMask=function(flag){if(gl.state.depthMask!==flag)return gl.state.depthMask=flag,originalDepthMask.call(gl,flag)},gl.depthRange),originalPolygonOffset=(gl.depthRange=function(near,far){if(gl.state.depthRange[0]!==near||gl.state.depthRange[1]!==far)return gl.state.depthRange=[near,far],originalDepthRange.call(gl,near,far)},gl.polygonOffset),originalSampleCoverage=(gl.polygonOffset=function(factor,units){if(gl.state.polygonOffset[0]!==factor||gl.state.polygonOffset[1]!==units)return gl.state.polygonOffset=[factor,units],originalPolygonOffset.call(gl,factor,units)},gl.sampleCoverage),originalScissor=(gl.sampleCoverage=function(value,invert){if(gl.state.sampleCoverage[0]!==value||gl.state.sampleCoverage[1]!==invert)return gl.state.sampleCoverage=[value,invert],originalSampleCoverage.call(gl,value,invert)},gl.scissor),originalStencilFunc=(gl.scissor=function(x,y,width,height){if(!arr4Eq(gl.state.scissor,x,y,width,height))return set4(gl.state.scissor,x,y,width,height),originalScissor.call(gl,x,y,width,height)},gl.stencilFunc),originalStencilOp=(gl.stencilFunc=function(func,ref,mask){if(!arr3Eq(gl.state.stencilFunc,func,ref,mask)||!arr3Eq(gl.state.stencilBackFunc,func,ref,mask))return set3(gl.state.stencilFunc,func,ref,mask),set3(gl.state.stencilBackFunc,func,ref,mask),originalStencilFunc.call(gl,func,ref,mask)},gl.stencilOp),originalStencilMask=(gl.stencilOp=function(fail,zfail,zpass){if(!arr3Eq(gl.state.stencilOp,fail,zfail,zpass)||!arr3Eq(gl.state.stencilBackOp,fail,zfail,zpass))return set3(gl.state.stencilOp,fail,zfail,zpass),set3(gl.state.stencilBackOp,fail,zfail,zpass),originalStencilOp.call(gl,fail,zfail,zpass)},gl.stencilMask),originalclearStencil=(gl.stencilMask=function(mask){if(gl.state.stencilMask!==mask||gl.state.stencilBackMask!==mask)return gl.state.stencilMask=mask,gl.state.stencilBackMask=mask,originalStencilMask.call(gl,mask)},gl.clearStencil),originalStencilFuncSeparate=(gl.clearStencil=function(s){if(gl.state.clearStencil!==s)return gl.state.clearStencil=s,originalclearStencil.call(gl,s)},gl.stencilFuncSeparate),originalStencilOpSeparate=(gl.stencilFuncSeparate=function(face,func,ref,mask){var setFront=face===gl.FRONT||face===gl.FRONT_AND_BACK,setBack=face===gl.BACK||face===gl.FRONT_AND_BACK;let needsUpdate=!1;if(setFront&&!arr3Eq(gl.state.stencilFunc,func,ref,mask)&&(set3(gl.state.stencilFunc,func,ref,mask),needsUpdate=!0),setBack&&!arr3Eq(gl.state.stencilBackFunc,func,ref,mask)&&(set3(gl.state.stencilBackFunc,func,ref,mask),needsUpdate=!0),needsUpdate)return originalStencilFuncSeparate.call(gl,face,func,ref,mask)},gl.stencilOpSeparate),originalStencilMaskSeparate=(gl.stencilOpSeparate=function(face,fail,zfail,zpass){var setFront=face===gl.FRONT||face===gl.FRONT_AND_BACK,setBack=face===gl.BACK||face===gl.FRONT_AND_BACK;let needsUpdate=!1;if(setFront&&!arr3Eq(gl.state.stencilOp,fail,zfail,zpass)&&(set3(gl.state.stencilOp,fail,zfail,zpass),needsUpdate=!0),setBack&&!arr3Eq(gl.state.stencilBackOp,fail,zfail,zpass)&&(set3(gl.state.stencilBackOp,fail,zfail,zpass),needsUpdate=!0),needsUpdate)return originalStencilOpSeparate.call(gl,face,fail,zfail,zpass)},gl.stencilMaskSeparate),originalDrawBuffers=(gl.stencilMaskSeparate=function(face,mask){let changed=!1;if(face!==gl.FRONT&&face!==gl.FRONT_AND_BACK||gl.state.stencilMask===mask||(gl.state.stencilMask=mask,changed=!0),face!==gl.BACK&&face!==gl.FRONT_AND_BACK||gl.state.stencilBackMask===mask||(gl.state.stencilBackMask=mask,changed=!0),changed)return originalStencilMaskSeparate.call(gl,face,mask)},gl.drawBuffers),originalReadBuffer=(gl.drawBuffers=function(buffers){return gl.lastDrawBufferBound.currentDrawBuffers=buffers.slice(),originalDrawBuffers.call(gl,buffers)},gl.readBuffer),originalBindFramebuffer=(gl.readBuffer=function(buffer){return gl.lastReadBufferBound.currentReadBuffer=buffer,originalReadBuffer.call(gl,buffer)},gl.bindFramebuffer),originalBindVertexArray=(gl.bindFramebuffer=function(fbType,fb){return fbType===gl.FRAMEBUFFER?(gl.sgl.boundFramebuffer=fb,gl.sgl.boundDrawingBuffer=fb,gl.sgl.boundReadingBuffer=fb,gl.lastReadBufferBound=fb,gl.lastDrawBufferBound=fb):fbType===gl.DRAW_FRAMEBUFFER?(gl.sgl.boundDrawingBuffer=fb,gl.lastDrawBufferBound=fb):fbType===gl.READ_FRAMEBUFFER&&(gl.sgl.boundReadingBuffer=fb,gl.lastReadBufferBound=fb),fb&&void 0===fb.id&&(fb.id=id++),originalBindFramebuffer.call(gl,fbType,fb)},gl.sgl.boundFramebuffer=null,gl.sgl.boundReadingBuffer=null,gl.sgl.boundDrawingBuffer=null,gl.bindVertexArray),originalBindBuffer=(gl.bindVertexArray=function(vao){gl.sgl.vertexArrayBinding!==vao&&(gl.sgl.vertexArrayBinding=vao,originalBindVertexArray.call(gl,vao))},gl.bindBuffer),originalPixelStorei=(gl.bindBuffer=function(target,buffer){if(gl.sgl.boundBufferTarget!==target||gl.sgl.boundBuffer!==buffer)return target===gl.ARRAY_BUFFER?gl.sgl.arrayBufferBinding=buffer:target===gl.ELEMENT_ARRAY_BUFFER?gl.sgl.elementArrayBufferBinding=buffer:target===gl.UNIFORM_BUFFER&&(gl.sgl.uniformBufferBinding=buffer),gl.sgl.boundBufferTarget=target,gl.sgl.boundBuffer=buffer,originalBindBuffer.call(gl,target,buffer)},gl.pixelStorei),originalEnable=(gl.pixelStorei=function(feat,value){gl.state.storei[feat]!==value&&(gl.state.storei[feat]=value,originalPixelStorei.call(gl,feat,value))},gl.enable),originalDisable=(gl.enable=function(feature){if(!0!==gl.state.feats[feature])return gl.state.feats[feature]=!0,originalEnable.call(gl,feature)},gl.disable);gl.disable=function(feature){if(!1!==gl.state.feats[feature])return gl.state.feats[feature]=!1,originalDisable.call(gl,feature)},gl.record=function(){history.length=0,recording=!0},gl.stopRecording=function(){recording=!1,console.log(history.slice())};gl.copyState=function(target,source){copySnapshot(target,source=source||gl)};function cpArr(t,s,l){for(let i=0;i<l;++i)t[i]=s[i]}function copySnapshot(target,source){Object.assign(target.state.feats,source.state.feats),Object.assign(target.state.storei,source.state.storei),target.state.activeTexture=source.state.activeTexture,cpArr(target.state.viewport,source.state.viewport,4),cpArr(target.state.blendColor,source.state.blendColor,4),target.state.blendEquationRgb=source.state.blendEquationRgb,target.state.blendEquationAlpha=source.state.blendEquationAlpha,target.state.cullFaceMode=source.state.cullFaceMode,target.state.depthFunc=source.state.depthFunc,target.state.frontFace=source.state.frontFace,target.state.lineWidth=source.state.lineWidth,cpArr(target.state.blendFuncSeparate,source.state.blendFuncSeparate,4),cpArr(target.state.clearColor,source.state.clearColor,4),cpArr(target.state.colorMask,source.state.colorMask,4),target.state.clearDepth=source.state.clearDepth,target.state.depthMask=source.state.depthMask,cpArr(target.state.depthRange,source.state.depthRange,2),cpArr(target.state.polygonOffset,source.state.polygonOffset,2),cpArr(target.state.sampleCoverage,source.state.sampleCoverage,2),cpArr(target.state.scissor,source.state.scissor,4),cpArr(target.state.stencilFunc,source.state.stencilFunc,3),cpArr(target.state.stencilOp,source.state.stencilOp,3),target.state.stencilMask=source.state.stencilMask,target.state.clearStencil=source.state.clearStencil,cpArr(target.state.stencilBackFunc,source.state.stencilBackFunc,3),cpArr(target.state.stencilBackOp,source.state.stencilBackOp,3),target.state.stencilBackMask=source.state.stencilBackMask,target.sgl.activeProgram=source.sgl.activeProgram,target.sgl.arrayBufferBinding=source.sgl.arrayBufferBinding,target.sgl.elementArrayBufferBinding=source.sgl.elementArrayBufferBinding,target.sgl.uniformBufferBinding=source.sgl.uniformBufferBinding,target.sgl.vertexArrayBinding=source.sgl.vertexArrayBinding,target.sgl.lastReadBufferBound=source.sgl.lastReadBufferBound,target.sgl.lastDrawBufferBound=source.sgl.lastDrawBufferBound,packFramebufferInto(gl,target.sgl.framebuffer,gl.sgl.boundFramebuffer,gl.FRAMEBUFFER),packFramebufferInto(gl,target.sgl.readingBuffer,gl.sgl.boundReadingBuffer,gl.READ_FRAMEBUFFER),packFramebufferInto(gl,target.sgl.drawingBuffer,gl.sgl.boundDrawingBuffer,gl.DRAW_FRAMEBUFFER);for(let i=0,il=gl.sgl.textures.length;i<il;i++)target.sgl.textures[i]=gl.sgl.textures[i]}gl.saveState=function(target){copySnapshot(target||gl.savedState,gl)},gl.createState=function(){var state=JSON.parse(JSON.stringify(gl.state)),sgl={};return sgl.arrayBufferBinding=gl.sgl.arrayBufferBinding,sgl.elementArrayBufferBinding=gl.sgl.elementArrayBufferBinding,sgl.uniformBufferBinding=gl.sgl.uniformBufferBinding,sgl.vertexArrayBinding=gl.sgl.vertexArrayBinding,sgl.activeProgram=gl.sgl.activeProgram,sgl.framebuffer=packFramebuffer(gl,gl.sgl.boundFramebuffer,gl.FRAMEBUFFER),sgl.readingBuffer=packFramebuffer(gl,gl.sgl.boundReadingBuffer,gl.READ_FRAMEBUFFER),sgl.drawingBuffer=packFramebuffer(gl,gl.sgl.boundDrawingBuffer,gl.DRAW_FRAMEBUFFER),sgl.lastDrawBufferBound=gl.lastDrawBufferBound,sgl.lastReadBufferBound=gl.lastReadBufferBound,sgl.textures=gl.sgl.textures.slice(),{state:state,sgl:sgl}},gl.restoreState=function(snapshot){setGLState(gl,snapshot||gl.savedState)},gl.setState=function(snapshot){setGLStatePartial(gl,snapshot)},gl.resetToDefaults=function resetToDefaults(){resetToDefaults()},gl.showCurrentState=function(){},gl.defaultPixelStore=function(){gl.state.storei[gl.UNPACK_FLIP_Y_WEBGL]&&gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),gl.state.storei[gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL]&&gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),gl.state.storei[gl.UNPACK_COLORSPACE_CONVERSION_WEBGL]!==gl.BROWSER_DEFAULT_WEBGL&&gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,gl.BROWSER_DEFAULT_WEBGL),4!==gl.state.storei[gl.UNPACK_ALIGNMENT]&&gl.pixelStorei(gl.UNPACK_ALIGNMENT,4),4!==gl.state.storei[gl.PACK_ALIGNMENT]&&gl.pixelStorei(gl.PACK_ALIGNMENT,4)},gl.slowFetchState=function(){return slowFetchGLState(gl)}}function resetWebGLCapabilities(gl){gl.disable(gl.BLEND),gl.disable(gl.CULL_FACE),gl.disable(gl.DEPTH_TEST),gl.disable(gl.DITHER),gl.disable(gl.POLYGON_OFFSET_FILL),gl.disable(gl.SAMPLE_ALPHA_TO_COVERAGE),gl.disable(gl.SAMPLE_COVERAGE),gl.disable(gl.SCISSOR_TEST),gl.disable(gl.STENCIL_TEST),gl.disable(gl.RASTERIZER_DISCARD)}function resetToDefaults(gl){resetWebGLCapabilities(gl),gl.bindVertexArray(null),gl.blendColor(0,0,0,0),gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD),gl.cullFace(gl.BACK),gl.depthFunc(gl.LESS),gl.frontFace(gl.CCW),gl.lineWidth(1),gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.clearColor(0,0,0,1),gl.colorMask(!0,!0,!0,!0),gl.clearDepth(1),gl.depthMask(!0),gl.depthRange(0,1),gl.polygonOffset(0,0),gl.sampleCoverage(1,!1),gl.stencilFunc(gl.ALWAYS,1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP),gl.stencilMask(255),gl.clearStencil(0),gl.stencilFuncSeparate(gl.BACK,gl.ALWAYS,1,255),gl.stencilOpSeparate(gl.BACK,gl.KEEP,gl.KEEP,gl.KEEP),gl.stencilMaskSeparate(gl.BACK,255)}function slowFetchGLState(gl){var state={},viewport=(state.feats=saveGLFeatures(gl),state.storei=saveStorei(gl),state.activeTexture=gl.getParameter(gl.ACTIVE_TEXTURE)||gl.TEXTURE0,gl.getParameter(gl.VIEWPORT)),viewport=(state.viewport=[viewport[0],viewport[1],viewport[2],viewport[3]],state.blendColor=gl.getParameter(gl.BLEND_COLOR),state.blendEquationRgb=gl.getParameter(gl.BLEND_EQUATION_RGB),state.blendEquationAlpha=gl.getParameter(gl.BLEND_EQUATION_ALPHA),state.cullFaceMode=gl.getParameter(gl.CULL_FACE_MODE),state.depthFunc=gl.getParameter(gl.DEPTH_FUNC),state.frontFace=gl.getParameter(gl.FRONT_FACE),state.lineWidth=gl.getParameter(gl.LINE_WIDTH),state.blendFuncSeparate=[gl.getParameter(gl.BLEND_SRC_RGB),gl.getParameter(gl.BLEND_DST_RGB),gl.getParameter(gl.BLEND_SRC_ALPHA),gl.getParameter(gl.BLEND_DST_ALPHA)],state.clearColor=gl.getParameter(gl.COLOR_CLEAR_VALUE),state.colorMask=gl.getParameter(gl.COLOR_WRITEMASK),state.clearDepth=gl.getParameter(gl.DEPTH_CLEAR_VALUE),state.depthMask=gl.getParameter(gl.DEPTH_WRITEMASK),state.depthRange=gl.getParameter(gl.DEPTH_RANGE),state.polygonOffset=[gl.getParameter(gl.POLYGON_OFFSET_FACTOR),gl.getParameter(gl.POLYGON_OFFSET_UNITS)],state.sampleCoverage=[gl.getParameter(gl.SAMPLE_COVERAGE_VALUE),gl.getParameter(gl.SAMPLE_COVERAGE_INVERT)],state.scissor=gl.getParameter(gl.SCISSOR_BOX),state.stencilFunc=[gl.getParameter(gl.STENCIL_FUNC),gl.getParameter(gl.STENCIL_REF),gl.getParameter(gl.STENCIL_VALUE_MASK)],state.stencilOp=[gl.getParameter(gl.STENCIL_FAIL),gl.getParameter(gl.STENCIL_PASS_DEPTH_FAIL),gl.getParameter(gl.STENCIL_PASS_DEPTH_PASS)],state.stencilMask=gl.getParameter(gl.STENCIL_WRITEMASK),2147483647===state.stencilMask&&(state.stencilMask=4294967295),state.clearStencil=gl.getParameter(gl.STENCIL_CLEAR_VALUE),state.stencilBackFunc=[gl.getParameter(gl.STENCIL_BACK_FUNC),gl.getParameter(gl.STENCIL_BACK_REF),gl.getParameter(gl.STENCIL_BACK_VALUE_MASK)],state.stencilBackOp=[gl.getParameter(gl.STENCIL_BACK_FAIL),gl.getParameter(gl.STENCIL_BACK_PASS_DEPTH_FAIL),gl.getParameter(gl.STENCIL_BACK_PASS_DEPTH_PASS)],state.stencilBackMask=gl.getParameter(gl.STENCIL_BACK_WRITEMASK),2147483647===state.stencilBackMask&&(state.stencilBackMask=4294967295),{});return viewport.activeProgram=gl.getParameter(gl.CURRENT_PROGRAM),viewport.arrayBufferBinding=gl.getParameter(gl.ARRAY_BUFFER_BINDING),viewport.elementArrayBufferBinding=gl.getParameter(gl.ELEMENT_ARRAY_BUFFER_BINDING),viewport.uniformBufferBinding=gl.getParameter(gl.UNIFORM_BUFFER_BINDING),viewport.vertexArrayBinding=gl.getParameter(gl.VERTEX_ARRAY_BINDING),viewport.framebuffer=glPackFramebuffer(gl,gl.getParameter(gl.FRAMEBUFFER_BINDING),gl.FRAMEBUFFER),viewport.readingBuffer=glPackFramebuffer(gl,gl.getParameter(gl.READ_FRAMEBUFFER_BINDING),gl.READ_FRAMEBUFFER),viewport.drawingBuffer=glPackFramebuffer(gl,gl.getParameter(gl.DRAW_FRAMEBUFFER_BINDING),gl.DRAW_FRAMEBUFFER),viewport.lastReadBufferBound=viewport.readingBuffer.buffer,viewport.lastDrawBufferBound=viewport.drawingBuffer.buffer,viewport.textures=getBoundTextures(gl,state.activeTexture),{state:state,sgl:viewport}}function glPackFramebuffer(gl,pxbuffer,type){var buf={buffer:pxbuffer};if(null!==pxbuffer&&(gl.bindFramebuffer(type,pxbuffer),type!==gl.FRAMEBUFFER&&type!==gl.READ_FRAMEBUFFER||(buf.readBuffer=gl.getParameter(gl.READ_BUFFER)),type===gl.FRAMEBUFFER||type===gl.DRAW_FRAMEBUFFER)){var maxDrawBuffers=gl.getParameter(gl.MAX_DRAW_BUFFERS);buf.drawBuffers=[];for(let i=0;i<maxDrawBuffers;i++)buf.drawBuffers.push(gl.getParameter(gl.DRAW_BUFFER0+i))}return buf}function packFramebuffer(gl,pxbuffer,type){var buf={buffer:pxbuffer};return null!==pxbuffer&&(type!==gl.FRAMEBUFFER&&type!==gl.READ_FRAMEBUFFER||(buf.readBuffer=pxbuffer.currentReadBuffer||gl.COLOR_ATTACHMENT0),type!==gl.FRAMEBUFFER&&type!==gl.DRAW_FRAMEBUFFER||(pxbuffer.currentDrawBuffers?buf.drawBuffers=pxbuffer.currentDrawBuffers.slice():buf.drawBuffers=gl.defaultDrawBuffers)),buf}function packFramebufferInto(gl,target,pxbuffer,type){target.buffer=pxbuffer;return target.readBuffer=void 0,target.drawBuffers=void 0,null!==pxbuffer&&(type!==gl.FRAMEBUFFER&&type!==gl.READ_FRAMEBUFFER||(target.readBuffer=pxbuffer.currentReadBuffer||gl.COLOR_ATTACHMENT0),type!==gl.FRAMEBUFFER&&type!==gl.DRAW_FRAMEBUFFER||(pxbuffer.currentDrawBuffers?target.drawBuffers=pxbuffer.currentDrawBuffers.slice():target.drawBuffers=gl.defaultDrawBuffers)),target}function getBoundTextures(gl,currentActive){for(var maxTextureUnits=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),textures=new Array(maxTextureUnits),i=0;i<maxTextureUnits;++i){gl.activeTexture(gl.TEXTURE0+i);let type=null,tx=null;(tx=gl.getParameter(gl.TEXTURE_BINDING_2D))?type=gl.TEXTURE_2D:(tx=gl.getParameter(gl.TEXTURE_BINDING_CUBE_MAP))?type=gl.TEXTURE_CUBE_MAP:(tx=gl.getParameter(gl.TEXTURE_BINDING_3D))?type=gl.TEXTURE_3D:(tx=gl.getParameter(gl.TEXTURE_BINDING_2D_ARRAY))&&(type=gl.TEXTURE_2D_ARRAY),textures[i]=type?[type,tx]:null}return gl.activeTexture(currentActive),textures}function restoreTextureBindings(gl,textures,currentActive){for(var i=0;i<16;i++){var currTex=gl.sgl.textures[i],tex=textures[i];currTex===tex||currTex&&tex&&tex[0]===currTex[0]&&tex[1]===currTex[1]||(gl.activeTexture(gl.TEXTURE0+i),gl.bindTexture(tex?tex[0]:gl.TEXTURE_2D,tex?tex[1]:null))}gl.activeTexture(currentActive)}function setGLState(gl,snapshot){var sgl=snapshot.sgl,snapshot=(gl.useProgram(sgl.activeProgram),gl.bindVertexArray(sgl.vertexArrayBinding),gl.bindBuffer(gl.ARRAY_BUFFER,sgl.arrayBufferBinding),gl.bindBuffer(gl.UNIFORM_BUFFER,sgl.uniformBufferBinding),snapshot.state);restoreGLFeatures(gl,snapshot.feats,gl.state.feats),restoreStorei(gl,snapshot.storei,gl.state.storei),gl.viewport(snapshot.viewport[0],snapshot.viewport[1],snapshot.viewport[2],snapshot.viewport[3]),gl.blendColor(snapshot.blendColor[0],snapshot.blendColor[1],snapshot.blendColor[2],snapshot.blendColor[3]),gl.blendEquationSeparate(snapshot.blendEquationRgb,snapshot.blendEquationAlpha),gl.cullFace(snapshot.cullFaceMode),gl.depthFunc(snapshot.depthFunc),gl.frontFace(snapshot.frontFace),gl.lineWidth(snapshot.lineWidth),gl.blendFuncSeparate(snapshot.blendFuncSeparate[0],snapshot.blendFuncSeparate[1],snapshot.blendFuncSeparate[2],snapshot.blendFuncSeparate[3]),gl.clearColor(snapshot.clearColor[0],snapshot.clearColor[1],snapshot.clearColor[2],snapshot.clearColor[3]),gl.colorMask(snapshot.colorMask[0],snapshot.colorMask[1],snapshot.colorMask[2],snapshot.colorMask[3]),gl.clearDepth(snapshot.clearDepth),gl.depthMask(snapshot.depthMask),gl.depthRange(snapshot.depthRange[0],snapshot.depthRange[1]),gl.polygonOffset(snapshot.polygonOffset[0],snapshot.polygonOffset[1]),gl.sampleCoverage(snapshot.sampleCoverage[0],snapshot.sampleCoverage[1]),gl.scissor(snapshot.scissor[0],snapshot.scissor[1],snapshot.scissor[2],snapshot.scissor[3]),gl.stencilFunc(snapshot.stencilFunc[0],snapshot.stencilFunc[1],snapshot.stencilFunc[2]),gl.stencilOp(snapshot.stencilOp[0],snapshot.stencilOp[1],snapshot.stencilOp[2]),gl.stencilMask(snapshot.stencilMask),gl.clearStencil(snapshot.clearStencil),gl.stencilFuncSeparate(gl.BACK,snapshot.stencilBackFunc[0],snapshot.stencilBackFunc[1],snapshot.stencilBackFunc[2]),gl.stencilOpSeparate(gl.BACK,snapshot.stencilBackOp[0],snapshot.stencilBackOp[1],snapshot.stencilBackOp[2]),gl.stencilMaskSeparate(gl.BACK,snapshot.stencilBackMask),sgl.lastDrawBufferBound===sgl.framebuffer.buffer&&(sgl.lastReadBufferBound,sgl.framebuffer.buffer),bindFramebufferWithReadDrawConfig(gl,gl.FRAMEBUFFER,sgl.framebuffer),sgl.lastDrawBufferBound===sgl.drawingBuffer.buffer&&sgl.lastDrawBufferBound!==sgl.framebuffer.buffer&&bindFramebufferWithReadDrawConfig(gl,gl.DRAW_FRAMEBUFFER,sgl.drawingBuffer),sgl.lastReadBufferBound===sgl.readingBuffer.buffer&&sgl.lastReadBufferBound!==sgl.framebuffer.buffer&&bindFramebufferWithReadDrawConfig(gl,gl.READ_FRAMEBUFFER,sgl.readingBuffer),restoreTextureBindings(gl,sgl.textures,snapshot.activeTexture)}function setGLStatePartial(gl,snapshot){var activeTexture,sgl=snapshot.sgl,snapshot=snapshot.state;sgl&&(sgl.activeProgram&&gl.useProgram(sgl.activeProgram),void 0!==sgl.vertexArrayBinding&&gl.bindVertexArray(sgl.vertexArrayBinding),void 0!==sgl.vertexArrayBinding&&sgl.elementArrayBufferBinding&&gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,sgl.elementArrayBufferBinding),void 0!==sgl.arrayBufferBinding&&gl.bindBuffer(gl.ARRAY_BUFFER,sgl.arrayBufferBinding),void 0!==sgl.uniformBufferBinding&&gl.bindBuffer(gl.UNIFORM_BUFFER,sgl.uniformBufferBinding),activeTexture=(snapshot&&void 0!==snapshot.activeTexture?snapshot:gl.state).activeTexture,sgl.textures)&&restoreTextureBindings(gl,sgl.textures,activeTexture),snapshot.feats&&setGLFeaturesPartial(gl,snapshot.feats,gl.state.feats),snapshot.viewport&&gl.viewport(snapshot.viewport[0],snapshot.viewport[1],snapshot.viewport[2],snapshot.viewport[3]),snapshot.blendColor&&gl.blendColor(snapshot.blendColor[0],snapshot.blendColor[1],snapshot.blendColor[2],snapshot.blendColor[3]),snapshot.blendEquationRgb&&snapshot.blendEquationAlpha&&gl.blendEquationSeparate(snapshot.blendEquationRgb,snapshot.blendEquationAlpha),void 0!==snapshot.cullFaceMode&&gl.cullFace(snapshot.cullFaceMode),void 0!==snapshot.depthFunc&&gl.depthFunc(snapshot.depthFunc),void 0!==snapshot.frontFace&&gl.frontFace(snapshot.frontFace),void 0!==snapshot.lineWidth&&gl.lineWidth(snapshot.lineWidth),snapshot.blendFuncSeparate&&gl.blendFuncSeparate(snapshot.blendFuncSeparate[0],snapshot.blendFuncSeparate[1],snapshot.blendFuncSeparate[2],snapshot.blendFuncSeparate[3]),snapshot.clearColor&&gl.clearColor(snapshot.clearColor[0],snapshot.clearColor[1],snapshot.clearColor[2],snapshot.clearColor[3]),snapshot.colorMask&&gl.colorMask(snapshot.colorMask[0],snapshot.colorMask[1],snapshot.colorMask[2],snapshot.colorMask[3]),void 0!==snapshot.clearDepth&&gl.clearDepth(snapshot.clearDepth),void 0!==snapshot.depthMask&&gl.depthMask(snapshot.depthMask),snapshot.depthRange&&gl.depthRange(snapshot.depthRange[0],snapshot.depthRange[1]),snapshot.polygonOffset&&gl.polygonOffset(snapshot.polygonOffset[0],snapshot.polygonOffset[1]),snapshot.sampleCoverage&&gl.sampleCoverage(snapshot.sampleCoverage[0],snapshot.sampleCoverage[1]),snapshot.scissor&&gl.scissor(snapshot.scissor[0],snapshot.scissor[1],snapshot.scissor[2],snapshot.scissor[3]),snapshot.stencilFunc&&gl.stencilFunc(snapshot.stencilFunc[0],snapshot.stencilFunc[1],snapshot.stencilFunc[2]),snapshot.stencilOp&&gl.stencilOp(snapshot.stencilOp[0],snapshot.stencilOp[1],snapshot.stencilOp[2]),snapshot.stencilMask&&gl.stencilMask(snapshot.stencilMask),snapshot.clearStencil&&gl.clearStencil(snapshot.clearStencil),snapshot.stencilBackFunc&&gl.stencilFuncSeparate(gl.BACK,snapshot.stencilBackFunc[0],snapshot.stencilBackFunc[1],snapshot.stencilBackFunc[2]),snapshot.stencilBackOp&&gl.stencilOpSeparate(gl.BACK,snapshot.stencilBackOp[0],snapshot.stencilBackOp[1],snapshot.stencilBackOp[2]),snapshot.stencilBackMask&&gl.stencilMaskSeparate(gl.BACK,snapshot.stencilBackMask),snapshot.framebuffer&&snapshot.lastDrawBufferBound===snapshot.framebuffer.buffer&&snapshot.lastReadBufferBound===snapshot.framebuffer.buffer&&(bindFramebufferWithReadDrawConfig(gl,gl.DRAW_FRAMEBUFFER,snapshot.drawingBuffer),bindFramebufferWithReadDrawConfig(gl,gl.READ_FRAMEBUFFER,snapshot.readingBuffer)),snapshot.framebuffer&&bindFramebufferWithReadDrawConfig(gl,gl.FRAMEBUFFER,snapshot.framebuffer),snapshot.drawingBuffer&&snapshot.lastDrawBufferBound===snapshot.drawingBuffer.buffer&&bindFramebufferWithReadDrawConfig(gl,gl.DRAW_FRAMEBUFFER,snapshot.drawingBuffer),snapshot.readingBuffer&&snapshot.lastReadBufferBound===snapshot.readingBuffer.buffer&&bindFramebufferWithReadDrawConfig(gl,gl.READ_FRAMEBUFFER,snapshot.readingBuffer)}function bindFramebufferWithReadDrawConfig(gl,fbType,bufferConfig){gl.bindFramebuffer(fbType,bufferConfig.buffer),null!==bufferConfig.buffer&&(fbType!==gl.FRAMEBUFFER&&fbType!==gl.DRAW_FRAMEBUFFER||gl.drawBuffers(bufferConfig.drawBuffers),fbType===gl.FRAMEBUFFER||fbType===gl.READ_FRAMEBUFFER)&&gl.readBuffer(bufferConfig.readBuffer)}export{enhanceWebGLContext};